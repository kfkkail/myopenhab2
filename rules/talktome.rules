val boolean alreadyTalkedOnce = false

rule "Allow Talking with Great Room Motion"
  when
    Time cron "0 0 15 ? * MON-FRI"
    // Turn on afternoon during week
  then
    logDebug("rules", "Enable TalkControl with Great Room Motion")

    sendCommand(TalkControl, ON)
end

rule "Disable Talk Control"
when
    Channel 'astro:sun:local:set#event' triggered START 
then
    logDebug("rules", "Disable Talk Control")

    sendCommand(TalkControl, OFF)
    
    createTimer(now.plusSeconds(10)) [|
      alreadyTalkedOnce = false
    ]
end

rule "Talk to me"
when
    Item GREATROOM_PIR_MOTION changed from OFF to ON
then
    logDebug("rules", "Talk to me when Talk Control is enabled")
    if(TalkControl.state == ON && alreadyTalkedOnce == false) {
      say("Welcome Home Andrea!")
      alreadyTalkedOnce = true
    }
end